name: Setup Project Labels

on:
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  setup-labels:
    name: Create Repository Labels
    runs-on: ubuntu-latest
    
    steps:
      - name: Create Labels
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const labels = [
              // Type Labels
              { name: 'bug', color: 'd73a4a', description: 'Something is not working correctly' },
              { name: 'enhancement', color: '0075ca', description: 'Improvement to existing functionality' },
              { name: 'feature-request', color: '7cfc00', description: 'Request for new functionality' },
              { name: 'question', color: 'd876e3', description: 'Further information is requested' },
              
              // Priority Labels (p0-p4)
              { name: 'p0', color: 'b60205', description: 'Critical - Security issues, data loss' },
              { name: 'p1', color: 'd93f0b', description: 'High - Important features, major bugs' },
              { name: 'p2', color: 'fbca04', description: 'Medium - Normal features and improvements' },
              { name: 'p3', color: '0e8a16', description: 'Low - Nice to have features' },
              { name: 'p4', color: 'c5def5', description: 'Lowest - Future considerations' },
              
              // Status Labels
              { name: 'needs-triage', color: 'fbbf24', description: 'Needs initial review and categorization' },
              { name: 'needs-info', color: 'ffa500', description: 'Waiting for more information' },
              { name: 'in-progress', color: '0052cc', description: 'Currently being worked on' },
              { name: 'blocked', color: 'e11d21', description: 'Blocked by external dependency' },
              { name: 'stale', color: '999999', description: 'No recent activity' },
              
              // AI Processing Labels
              { name: 'ai-processing', color: '8b5cf6', description: 'Being processed by AI automation' },
              { name: 'ai-processing-error', color: 'd73a4a', description: 'AI processing encountered an error' },
              
              // Special Labels
              { name: 'duplicate', color: '6b7280', description: 'Duplicate of another issue' },
              { name: 'wontfix', color: '6b7280', description: 'This will not be worked on' },
              { name: 'good-first-issue', color: '7cfc00', description: 'Good for newcomers' }
            ];
            
            console.log('🏷️  Creating repository labels...\n');
            
            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`✅ Created: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  console.log(`⚠️  Already exists: ${label.name}`);
                } else {
                  console.error(`❌ Error creating ${label.name}:`, error.message);
                }
              }
            }
            
            console.log('\n🎉 Label setup completed!');

      - name: Display Summary
        run: |
          echo "## 📋 Labels Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Category | Labels |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Type** | bug, enhancement, feature-request, question |" >> $GITHUB_STEP_SUMMARY
          echo "| **Priority** | p0 (critical), p1 (high), p2 (medium), p3 (low), p4 (lowest) |" >> $GITHUB_STEP_SUMMARY
          echo "| **Status** | needs-triage, needs-info, in-progress, blocked, stale |" >> $GITHUB_STEP_SUMMARY
          echo "| **AI** | ai-processing, ai-processing-error |" >> $GITHUB_STEP_SUMMARY
          echo "| **Special** | duplicate, wontfix, good-first-issue |" >> $GITHUB_STEP_SUMMARY